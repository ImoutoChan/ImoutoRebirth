<Window x:Class="ImoutoRebirth.Tori.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ImoutoRebirth.Tori.UI"
        xmlns:viewModels="clr-namespace:ImoutoRebirth.Tori.UI.ViewModels"
        mc:Ignorable="d"
        Title="ImoutoRebirth Installer" Height="600" Width="800"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">
    <Window.DataContext>
        <viewModels:MainViewModel/>
    </Window.DataContext>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#007ACC" Padding="20">
            <TextBlock Text="ImoutoRebirth Installer" 
                     Foreground="White" 
                     FontSize="24" 
                     FontWeight="Bold"/>
        </Border>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" Padding="20">
            <StackPanel>
                <TextBlock Text="{Binding StatusMessage}" Margin="0,0,0,10"/>
                
                <!-- Existing Installation -->
                <Border Background="#e0f7fa" Padding="10" Margin="0,0,0,20" 
                        Visibility="{Binding IsExistingInstallation, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="Existing Installation Detected" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBlock Text="{Binding ExistingInstallPath, StringFormat=Installation path: {0}}" Margin="0,0,0,5"/>
                        <TextBlock Text="Configuration has been loaded from the existing installation" Margin="0,0,0,5"/>
                    </StackPanel>
                </Border>
                
                <!-- System Requirements -->
                <GroupBox Header="System Requirements" Margin="0,0,0,20">
                    <StackPanel>
                        <!-- .NET Runtime -->
                        <StackPanel Margin="0,10,0,10">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <TextBlock Text=".NET Runtime Status: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding HasRequiredRuntimes, Converter={StaticResource BooleanToStatusConverter}}"/>
                            </StackPanel>
                            
                            <CheckBox Content="Install .NET Runtime" 
                                      IsChecked="{Binding ShouldInstallDotnetRuntime}"
                                      IsEnabled="{Binding HasRequiredRuntimes, Converter={StaticResource InverseBooleanConverter}}"
                                      Visibility="{Binding HasRequiredRuntimes, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                      Margin="10,0,0,0"/>
                        </StackPanel>
                        
                        <!-- PostgreSQL -->
                        <StackPanel Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <TextBlock Text="PostgreSQL Status: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding PostgresStatus}"/>
                            </StackPanel>
                            
                            <CheckBox Content="Install PostgreSQL" 
                                      IsChecked="{Binding ShouldInstallPostgres}"
                                      IsEnabled="{Binding HasPostgres, Converter={StaticResource InverseBooleanConverter}}"
                                      Visibility="{Binding HasPostgres, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                      Margin="10,0,0,0"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <!-- Configuration -->
                <GroupBox Header="Configuration" Margin="0,0,0,20">
                    <StackPanel>
                        <!-- Database Configuration -->
                        <Expander Header="Database Settings" IsExpanded="True" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="PostgreSQL Connection" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Configuration.LilinConnectionString}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Meido Connection" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Configuration.MeidoConnectionString}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Room Connection" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Configuration.RoomConnectionString}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="MassTransit Connection" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding Configuration.MassTransitConnectionString}" 
                                             Margin="0,5,0,5"/>
                                </Grid>
                            </StackPanel>
                        </Expander>

                        <!-- Service Ports -->
                        <Expander Header="Service Ports" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Room Port" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Configuration.RoomPort}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Lilin Port" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Configuration.LilinPort}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Kekkai Port" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Configuration.KekkaiPort}" 
                                             Margin="0,5,0,5"/>
                                </Grid>
                            </StackPanel>
                        </Expander>

                        <!-- Booru Settings -->
                        <Expander Header="Booru Settings" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <!-- Danbooru -->
                                <TextBlock Text="Danbooru" FontWeight="Bold" FontSize="14" Margin="0,5,0,5"/>
                                <TextBlock Text="Optional but recommended for tag search functionality." 
                                           Margin="10,0,0,10" TextWrapping="Wrap"/>
                                
                                <Grid Margin="20,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Login" 
                                               Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Configuration.DanbooruLogin}" 
                                             Margin="0,5,0,5"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="Your Danbooru account username." 
                                               Foreground="Gray" FontSize="11" Margin="5,0,0,10"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="API Key" 
                                               Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Configuration.DanbooruApiKey}" 
                                             Margin="0,5,0,5"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" Text="Your Danbooru API key (find at the bottom of your profile page)." 
                                               Foreground="Gray" FontSize="11" Margin="5,0,0,5"/>
                                </Grid>
                                
                                <!-- Sankaku -->
                                <TextBlock Text="Sankaku" FontWeight="Bold" FontSize="14" Margin="0,5,0,5"/>
                                <TextBlock Text="Optional for Sankaku tag search functionality." 
                                           Margin="10,0,0,10" TextWrapping="Wrap"/>
                                
                                <Grid Margin="20,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Login" 
                                               Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Configuration.SankakuLogin}" 
                                             Margin="0,5,0,5"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="Your Sankaku account username." 
                                               Foreground="Gray" FontSize="11" Margin="5,0,0,10"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Password" 
                                               Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Configuration.SankakuPassword}" 
                                             Margin="0,5,0,5"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" Text="Your Sankaku account password." 
                                               Foreground="Gray" FontSize="11" Margin="5,0,0,5"/>
                                </Grid>
                                
                                <!-- Yandere -->
                                <TextBlock Text="Yandere" FontWeight="Bold" FontSize="14" Margin="0,5,0,5"/>
                                <TextBlock Text="Optional but recommended for tag search functionality." 
                                           Margin="10,0,0,10" TextWrapping="Wrap"/>
                                
                                <Grid Margin="20,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Login" 
                                               Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Configuration.YandereLogin}" 
                                             Margin="0,5,0,5"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="Your Yandere account username." 
                                               Foreground="Gray" FontSize="11" Margin="5,0,0,10"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="API Key" 
                                               Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Configuration.YandereApiKey}" 
                                             Margin="0,5,0,5"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" Text="Your Yandere API key (find in Profile / Settings)." 
                                               Foreground="Gray" FontSize="11" Margin="5,0,0,5"/>
                                </Grid>
                            </StackPanel>
                        </Expander>
                        
                        <!-- ExHentai Settings -->
                        <Expander Header="ExHentai Settings" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="IPB Member ID" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Configuration.ExHentaiIpbMemberId}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="IPB Pass Hash" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Configuration.ExHentaiIpbPassHash}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Igneous" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Configuration.ExHentaiIgneous}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="User Agent" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding Configuration.ExHentaiUserAgent}" 
                                             Margin="0,5,0,5"/>
                                </Grid>
                            </StackPanel>
                        </Expander>

                        <!-- Other Settings -->
                        <Expander Header="Other Settings" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Install Location" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Configuration.InstallLocation}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Harpy Save Path" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Configuration.HarpySavePath}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="OpenSearch URI" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Configuration.OpenSearchUri}" 
                                             Margin="0,5,0,5"/>
                                    
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Jaeger Host" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding Configuration.JaegerHost}" 
                                             Margin="0,5,0,5"/>
                                             
                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Jaeger Port" 
                                               FontWeight="Bold" Margin="0,5,10,5" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding Configuration.JaegerPort}" 
                                             Margin="0,5,0,5"/>
                                </Grid>
                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="2" Background="#F0F0F0" Padding="10">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="{Binding InstallButtonText}"
                        Command="{Binding InstallCommand}"
                        Padding="20,5"/>
            </StackPanel>
        </Border>
    </Grid>
</Window> 
